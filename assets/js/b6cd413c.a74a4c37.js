"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[420],{3631:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>b,frontMatter:()=>s,metadata:()=>r,toc:()=>a});var i=t(5893),o=t(1151);const s={sidebar_position:4},d="\u4f7f\u7528 Opensbi \u5f15\u5bfc\u81ea\u5df1\u7684 bl33",r={id:"Milkv-duo/opensbi-boot-os",title:"\u4f7f\u7528 Opensbi \u5f15\u5bfc\u81ea\u5df1\u7684 bl33",description:"\u4e4b\u524d\u5728 \u4f7f\u7528uboot\u5f15\u5bfc\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf \u4e2d\u5c1d\u8bd5\u4e86\u4f7f\u7528 opensbi \u6765\u5f15\u5bfc\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f46\u662f\u5f53\u65f6\u53d1\u73b0\u65e0\u8bba\u662f\u5236\u4f5c fip \u65f6\u8fd8\u662f ATF \u542f\u52a8\u65f6\u90fd\u5bf9 bl33 \u7684\u955c\u50cf\u6709\u683c\u5f0f\u8981\u6c42\u3002",source:"@site/docs/Milkv-duo/opensbi-boot-os.md",sourceDirName:"Milkv-duo",slug:"/Milkv-duo/opensbi-boot-os",permalink:"/docs/Milkv-duo/opensbi-boot-os",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528uboot\u5f15\u5bfc\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf",permalink:"/docs/Milkv-duo/uboot-boot-os"}},l={},a=[];function c(n){const e={a:"a",code:"code",h1:"h1",img:"img",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"\u4f7f\u7528-opensbi-\u5f15\u5bfc\u81ea\u5df1\u7684-bl33",children:"\u4f7f\u7528 Opensbi \u5f15\u5bfc\u81ea\u5df1\u7684 bl33"}),"\n",(0,i.jsxs)(e.p,{children:["\u4e4b\u524d\u5728 ",(0,i.jsx)(e.a,{href:"/docs/Milkv-duo/uboot-boot-os",children:"\u4f7f\u7528uboot\u5f15\u5bfc\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf"})," \u4e2d\u5c1d\u8bd5\u4e86\u4f7f\u7528 opensbi \u6765\u5f15\u5bfc\u81ea\u5df1\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f46\u662f\u5f53\u65f6\u53d1\u73b0\u65e0\u8bba\u662f\u5236\u4f5c fip \u65f6\u8fd8\u662f ATF \u542f\u52a8\u65f6\u90fd\u5bf9 bl33 \u7684\u955c\u50cf\u6709\u683c\u5f0f\u8981\u6c42\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u6bb5\u65f6\u95f4\u5b66\u4e60\u4e86\u4e0b riscv \u7684\u6c47\u7f16\u548c\u94fe\u63a5\u811a\u672c\uff0c\u7136\u540e\u91cd\u65b0\u770b\u4e86\u4e0b ATF \u548c uboot \u7684\u4ee3\u7801\uff0c\u53d1\u73b0\u5236\u4f5c\u81ea\u5df1\u7684 bl33 \u955c\u50cf\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u53ea\u8981\u5728\u7a0b\u5e8f\u7684\u6700\u5f00\u59cb\u5904\u52a0\u5165\u4ee5\u4e0b\u4fe1\u606f\u5373\u53ef\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"_start:\n\t/* BL33 information */\n\tj real_start\n\t.balign 4\n\t.word 0x33334c42  /* b'BL33' */\n\t.word 0xdeadbeea  /* CKSUM */\n\t.word 0xdeadbeeb  /* SIZE */\n\t.quad 0x80200000  /* RUNADDR */\n\t.word 0xdeadbeec\n\t.balign 4\n\tj real_start\n\t.balign 4\n\t/* BL33 end */\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1a"})}),"\n",(0,i.jsx)(e.p,{children:"\u82e5\u6ca1\u6709\u7f16\u8bd1\u8fc7 sdk \u7684\u8bdd\u9700\u8981\u5148\u7f16\u8bd1\u4e0b fsbl \u6765\u83b7\u5f97 bl2 \u955c\u50cf\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"export MILKV_BOARD=milkv-duo\nsource milkv/boardconfig-milkv-duo.sh\n\nsource build/milkvsetup.sh\ndefconfig cv1800b_milkv_duo_sd\n\nbuild_fsbl\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u7136\u540e\u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684\u7a0b\u5e8f\uff0c\u4f7f\u7528 uart8250 \u6765\u6253\u5370\u4e00\u53e5\u5b57\u7b26\u4e32\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"#define UART0_THR 0x04140000\n#define UART0_LSR 0x04140014\n\n\t.section .text\n\t.global _start\n_start:\n\t/* BL33 information */\n\tj real_start\n\t.balign 4\n\t.word 0x33334c42  /* b'BL33' */\n\t.word 0xdeadbeea  /* CKSUM */\n\t.word 0xdeadbeeb  /* SIZE */\n\t.quad 0x80200000  /* RUNADDR */\n\t.word 0xdeadbeec\n\t.balign 4\n\tj real_start\n\t.balign 4\n\t/* Information end */\n\nreal_start:\n\tla s0, str\n1:\n\tlbu a0, (s0)\n\tbeqz a0, exit\n\tjal ra, uart_send\n\taddi s0, s0, 1\n\tj 1b\n\nexit:\n\tj exit\n\nuart_send:\n\t/* Wait for tx idle */\n\tli t0, UART0_LSR\n\tlw t1, (t0)\n\tandi t1, t1, 0x20\n\tbeqz t1, uart_send\n\t/* Send a char */\n\tli t0, UART0_THR\n\tsw a0, (t0)\n\tret\n\n.section .rodata\nstr: \n\t.asciz \"Hello Milkv-duo!\\n\"\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u7f16\u8bd1\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"riscv64-unknown-elf-gcc -nostdlib -fno-builtin -march=rv64gc -mabi=lp64f -g -Wall -Ttext=0x80200000 -o bl33.elf start.S\n\nriscv64-unknown-elf-objcopy -O binary bl33.elf bl33.bin\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6b64\u65f6\u53ef\u4ee5\u7528 ",(0,i.jsx)(e.code,{children:"hd"})," \u770b\u4e00\u4e0b\u751f\u6210\u7684 ",(0,i.jsx)(e.code,{children:"bin"})," \u6587\u4ef6\uff0c\u4f1a\u53d1\u73b0\u5df2\u7ecf\u5b58\u5728\u4e86\u7528\u4e8e\u6821\u9a8c\u7684\u4e24\u884c\u6570\u636e\uff0c\u800c opensbi \u5b9e\u9645\u4f1a\u8df3\u8f6c\u5230 ",(0,i.jsx)(e.code,{children:"0x80200020"})," \u6765\u6267\u884c\u6211\u4eec\u7684\u7a0b\u5e8f\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"00000000  05 a0 01 00 42 4c 33 33  ea be ad de eb be ad de  |....BL33........|\n00000010  00 00 20 80 00 00 00 00  ec be ad de 11 a0 01 00  |.. .............|\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u8fdb\u5165\u5230 ",(0,i.jsx)(e.code,{children:"fsbl"})," \u76ee\u5f55\u751f\u6210 ",(0,i.jsx)(e.code,{children:"fip.bin"})," \u6587\u4ef6\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"cd fsbl/\n\n./plat/cv180x/fiptool.py -v genfip \\\n    'build/cv1800b_milkv_duo_sd/fip.bin' \\\n    --MONITOR_RUNADDR=\"0x0000000080000000\" \\\n    --CHIP_CONF='build/cv1800b_milkv_duo_sd/chip_conf.bin' \\\n    --NOR_INFO='FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF' \\\n    --NAND_INFO='00000000'\\\n    --BL2='build/cv1800b_milkv_duo_sd/bl2.bin' \\\n    --DDR_PARAM='test/cv181x/ddr_param.bin' \\\n    --MONITOR='../opensbi/build/platform/generic/firmware/fw_dynamic.bin' \\\n    --LOADER_2ND='/home/jude/Code/duo/bl33/bl33.bin' \\\n    --compress='lzma'\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u6700\u540e\u5c06 ",(0,i.jsx)(e.code,{children:"fip.bin"})," \u6587\u4ef6\u653e\u5230 tf \u5361\uff0c\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"128000"})," \u6bd4\u7279\u7387\u8fde\u63a5\u5230\u677f\u5b50\u7684\u4e32\u53e3\uff0c\u5c31\u80fd\u770b\u5230\u6211\u4eec\u7684\u6253\u5370\u4fe1\u606f\u4e86\uff1a"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:t(8866).Z+"",width:"540",height:"339"})})]})}function b(n={}){const{wrapper:e}={...(0,o.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(c,{...n})}):c(n)}},8866:(n,e,t)=>{t.d(e,{Z:()=>i});const i=t.p+"assets/images/opensbi-boot-8570171352e7e6d8a8e94d4c075e3367.png"},1151:(n,e,t)=>{t.d(e,{Z:()=>r,a:()=>d});var i=t(7294);const o={},s=i.createContext(o);function d(n){const e=i.useContext(s);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:d(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);